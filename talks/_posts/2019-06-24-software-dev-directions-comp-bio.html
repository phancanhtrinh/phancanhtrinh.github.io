---
layout: talk_reveal3
title:  Software development directions
venue: Fred Hutch
event: Comp Bio Faculty Seminar
author: Trevor Bedford
draft: true
---

<section data-background="#000">
	<h1 class="title">{{ page.title }}</h1>
	<br>
	<p class="title">
	Trevor Bedford (@trvrb)
	<br>
	{{ page.date | date: "%-d %b %Y" }}
	<br>
	{{ page.event }}
	<br>
	{{ page.venue }}
</section>

<section style="text-align: left;">
	<h2>This talk</h2>
	<p>
	<ul>
		<li>Nextstrain software stack and future directions</li>
		<li>Seattle Flu Study overview and Y2 planning (time permitting)</li>
	<ul>
	</p>
</section>

<section>
	<h1>
		<span class="c1s">N</span><span class="c2s">e</span><span class="c3s">x</span><span class="c4s">t</span><span class="c5s">s</span><span class="c6s">t</span><span class="c7s">r</span><span class="c8s">a</span><span class="c9s">i</span><span class="c10s">n</span>
	</h1>
	<p>Project to conduct real-time molecular epidemiology and evolutionary analysis of emerging epidemics</p>
	<br>
	<p class="smaller"><i>
		with
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/richard-neher.jpg"> Richard Neher,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/james-hadfield.jpg"> James Hadfield,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/emma-hodcroft.jpg"> Emma Hodcroft,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/thomas-sibley.jpg"> Tom Sibley,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/colin-megill.jpg"> Colin Megill,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/john-huddleston.jpg"> John Huddleston,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/barney-potter.jpg"> Barney Potter,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/sidney-bell.jpg"> Sidney Bell,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/louise-moncla.jpg"> Louise Moncla,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/charlton-callender.jpg"> Charlton Callender,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/misja-ilcisin.jpg"> Misja Ilcisin,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/kairsten-fay.jpg"> Kairsten Fay,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/jover-lee.jpg"> Jover Lee</span>
	</i></p>
</section>

<section>
	<h3>Nextstrain architecture</h3>
	<p>All code open source at <a class="off" href="https://github.com/nextstrain">github.com/nextstrain</a></p>
	<img class="stretch" src="/images/talks/nextstrain_components.png">
</section>

<section style="text-align: left;">
	<h2><a href="https://github.com/nextstrain/fauna">Database: Fauna</a></h2>
	<p style="line-height: 2em;">
		<b>Database of virus sequences and titer measurements</b>
		<br>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/trevor-bedford.jpg"> Trevor Bedford,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/charlton-callender.jpg"> Charlton Callender,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/barney-potter.jpg"> Barney Potter</span>
	</p>
	<p>
	<ul>
		<li>Harmonizes data from different sources</li>
		<li>Provides an interface for downstream analysis</li>
		<li>Three datatypes: virus, sequence and titer measurement</li>
		<li>Written in RethinkDB, a flavor of NoSQL with a pleasant API</li>
		<li>NoSQL nice for data import, but imposes downstream sanity checks</li>
		<li>Easier to shard a NoSQL database, but performance on a single server is far worse</li>
	<ul>
	</p>
</section>

<section style="text-align: left;">
	<h2><a href="https://github.com/seattleflu/id3c">Database: ID3C</a></h2>
	<p style="line-height: 2em;">
		<b>Datasystem to support data receiving, warehousing and shipping views</b>
		<br>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/thomas-sibley.jpg"> Thomas Sibley,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/jover-lee.jpg"> Jover Lee,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/kairsten-fay.jpg"> Kairsten Fay</span>
	</p>
	<p >
	<ul>
		<li>Three "areas": receiving, warehouse, shipping</li>
		<li>Extract, transform, load (ETL) pipelines run on receiving</li>
		<li>Datatypes include individual, encounter, sample, genome, place</li>
		<li>Written in PostgreSQL, (mostly) requiring structured schemas</li>
		<li>More work on data import, but ensures downstream cleanliness</li>
		<li>Postgres highly performant on a single server</li>
		<li>Structured data allows layering of tools like Metabase</li>
	<ul>
	</p>
</section>

<section style="text-align: left;">
	<h2><a href="https://github.com/nextstrain/augur">Workflow: Augur</a></h2>
	<p style="line-height: 2em;">
		<b>Workflows for phylodynamic analyses</b>
		<br>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/richard-neher.jpg"> Richard Neher,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/trevor-bedford.jpg"> Trevor Bedford,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/john-huddleston.jpg"> John Huddleston,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/emma-hodcroft.jpg"> Emma Hodcroft,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/james-hadfield.jpg"> James Hadfield,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/thomas-sibley.jpg"> Thomas Sibley</span>
	</p>
	<p>
	<ul>
		<li>Flexible build scripts to incorporate different viruses and analyses</li>
		<li>Constructs time-resolved phylogenies</li>
		<li>Annotates with geographic transitions and mutation events</li>
	<ul>
	</p>
</section>

<section>
	<div class="left" style="float:left; width:65%">
		<h3>Workflow consists of Unix-like command line modules</h3>
		<p>
		<ul>
			<li>Originally, a single Python program with a <a href="https://github.com/nextstrain/augur/blob/master/builds/dengue/dengue.process.py#L97">set of methods to mutate data</a></li>
			<li>Rewritten to be a series of modules called via <code>augur filter</code>, <code>augur tree</code>, <code>augur traits</code>, etc...</li>
			<li>Composable across pathogen builds</li>
			<li>Uses <a href="https://github.com/nextstrain/zika/blob/master/Snakefile#L1">Snakemake to define a pipeline</a>, making steps obvious</li>
			<li>Provides dependency graph for fast recomputation</li>
			<li>Pathogen-specific repos give users an obvious foundation to build off of</li>
		</ul>
	</div>
	<div class="right" style="float:right; width:35%">
		<img data-src="/images/talks/nextstrain_augur_dag.png">
	</div>
</section>

<section style="text-align: left;">
	<h2><a href="https://github.com/nextstrain/auspice">Viz: Auspice</a></h2>
	<p>
		<b>Web visualization of resulting trees</b>
		<br>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/james-hadfield.jpg"> James Hadfield,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/colin-megill.jpg"> Colin Megill,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/trevor-bedford.jpg"> Trevor Bedford,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/richard-neher.jpg"> Richard Neher,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/emma-hodcroft.jpg"> Emma Hodcroft,</span>
		<span class="nobreak"><img width=35 class="img-avatar" src="/images/team/thomas-sibley.jpg"> Thomas Sibley</span>
	</p>
	<p>
	<ul>
		<li>Interactive data exploration and filtering</li>
		<li>Connects phylogeny, geography and genotypes</li>
		<li><a href="https://d3js.org/">D3.js</a> used to construct visual elements, through specific data encodings</li>
		<li>Originally, <a href="https://nextflu.org/deprecated/">written in pure D3</a>, but this resulted in overly tangled "wiring"</li>
		<li>Rewritten to wrap dataflow in React, in which components are (largely) state-less and redraw upon data updates</li>
		<li>Global state maintained by Redux datastore</li>
	<ul>
	</p>
</section>

<section style="text-align: left;">
	<h3>Auspice design discussion</h3>
	<img class="stretch" src="/images/talks/nextstrain_demo_zika.png">
</section>

<section>
	<h3>Currently, managing sharing through GitHub as "community" builds</h3>
	<img class="stretch" src="/images/talks/nextstrain_ebola_drc_2019_03_27.png">
	<div class="citation">
		<a href="https://nextstrain.org/community/inrb-drc/ebola-nord-kivu">INRB/USAMRIID Nextstrain</a>
	</div>
</section>

<section>
	<h3>"Cloud augur" as major development direction for Nextstrain</h3>
	<img class="stretch" src="/images/talks/nextstrain_hub.png">
</section>

<section style="text-align: left;">
	<h3>User story</h3>
	<p>
	<ul>
		<li>User navigates to nextstrain.org/upload</li>
		<li>User drag-and-drops local FASTA sequences and TSV metadata</li>
		<li>User selects appropriate available build, ie nextstrain/zika</li>
		<li>Build runs "in the cloud" with spiking in clean Zika data from our database</li>
		<li>User is given a persistent URL nextstrain.org/trvrb/zika that gives an auspice view</li>
	<ul>
	</p>
</section>

<section>
	<h3>
		Discussion on generic Comp Bio data flow:
		<br>
		Database &rarr; Workflow &rarr; Viz
	</h3>
</section>
